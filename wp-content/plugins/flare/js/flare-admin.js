(function(b,a,c){a.FlareAdmin={elems:{},ns:__namespace,assignEvents:function(){var d=this;this.elems.buttonList.delegate(".button-mode-choice","click."+this.ns,function(g){var j=b.data(this,"$this"),h=b.data(this,"$easy"),f=b.data(this,"$code"),i=b.data(this,"$easyButton"),e=b.data(this,"$codeButton");if(!j){j=b(this);b.data(this,"$this",j)}if(!h){h=j.closest(".button-row").find(".button-mode-config.button-mode-easy");b.data(this,"$easy",h)}if(!f){f=j.closest(".button-row").find(".button-mode-config.button-mode-code");b.data(this,"$code",f)}if(!i){if(this.value=="easy"){i=j.closest("label")}else{i=j.closest(".button-row").find('.button-mode-choice[value="easy"]').closest("label")}b.data(this,"$easyButton",i)}if(!e){if(this.value=="code"){e=j.closest("label")}else{e=j.closest(".button-row").find('.button-mode-choice[value="code"]').closest("label")}b.data(this,"$codeButton",e)}if(this.value=="easy"){h.slideDown(500);f.slideUp(500);i.hide();e.show()}else{if(this.value=="code"){h.slideUp(500);f.slideDown(500);e.hide();i.show()}}});this.elems.buttonList.delegate(".button-row .button-delete","click."+this.ns,function(g){g.preventDefault();var h=b(this);var e=h.closest(".button-row").attr("data-button-type");if(confirm("Are you sure you want to delete this button?")){h.closest(".button-row").slideUp(500,function(){b(this).remove();d.updateAvailableButtons()});var f=h.attr("data-button-id");if(f){d.elems.form.append('<input type="hidden" name="data[delete][]" value="'+f+'" id="'+d.ns+"-delete-button-"+f+'" />')}}});this.elems.buttonList.delegate(".button-row a."+this.ns+"-button","click."+this.ns,function(e){e.preventDefault()});this.elems.addButtons.find("a."+this.ns+"-button").bind("click."+this.ns,function(e){e.preventDefault();b.ajax({url:this.href,type:"GET",cache:false,success:function(g){d.elems.buttonList.append(g);var f=d.elems.buttonList.find(".button-color");f.each(function(i){var h=f.eq(i);if(!h.data("hsb")){h.miniColors({change:function(k,j){this.trigger("change")}})}});d.updateAvailableButtons();d.updateIconStyle()}})});this.elems.addButtons.find("#"+this.ns+"-add-button-link").bind("click."+this.ns,function(f){f.preventDefault();if(d.elems.addButtons.hasClass("disabled")){return false}var e=b.data(this,"$buttons");if(!e){e=d.elems.addButtons.find("ul");b.data(this,"$buttons",e)}if(e.hasClass("buttons-open")){e.removeClass("buttons-open")}else{e.addClass("buttons-open")}});this.elems.buttonList.delegate("input.button-color","change",function(e){var g=b.data(this,"$this"),f=b.data(this,"$button");if(!g){g=b(this);b.data(this,"$this",g)}if(!f){f=g.closest(".button-row").find("."+d.ns+"-button");b.data(this,"$button",f)}f.css("background-color",this.value)});this.elems.iconStyle.bind("change",function(e){d.updateIconStyle()});this.elems.positionChoices.find('input[type="checkbox"]').bind("click",function(g){var h=b.data(this,"$this")||b.data(this,"$this",b(this));var f=b.data(this,"$select")||b.data(this,"$select",h.closest("p").find(".fancy-select"));var e="";f.find("option").each(function(i){if(h[0].checked){if(i==1){this.selected=true;e=this.text}}else{this.selected=(this.value=="none")}});f.find(".selected").text(e)});this.elems.positionChoices.find('input[name="data[positions][]"]').bind("click",function(){d.updatePositions()});this.elems.positionChoices.find('select[name="data[positions][]"]').bind("change",function(){d.updatePositions();var f=b.data(this,"$this")||b.data(this,"$this",b(this));var e=b.data(this,"$checkbox")||b.data(this,"$checkbox",f.closest("p").find('input[type="checkbox"]'));if(f.find("option:selected").val()=="none"){e.removeAttr("checked")[0].checked=false;e.closest(".fancy-checkbox").removeClass("on").addClass("off")}else{e.attr("checked","checked")[0].checked=true;e.closest(".fancy-checkbox").removeClass("off").addClass("on")}});this.elems.buttonList.delegate(".fancy-select","click",function(f){var e=b(this).find("select");b("#fancyform-options-dropdown").addClass("for-"+e.attr("id"))});a.onbeforeunload=function(){if(d.originalSerialize!=d.elems.form.serialize()){return"You have unsaved changes. Are you sure you want to leave without saving?"}};this.elems.form.bind("submit",function(){a.onbeforeunload=null})},initialize:function(){this.elems.form=b("#"+this.ns+"-form");this.elems.buttonList=b("#"+this.ns+"-button-list");this.elems.addButtons=b("#"+this.ns+"-add-button");this.elems.iconStyle=b("#"+this.ns+"-choose-iconstyle");this.elems.positionDisplay=b("#"+this.ns+"-position-display");this.elems.positionChoices=b("#"+this.ns+"-position-choices");this.originalSerialize=this.elems.form.serialize();this.elems.buttonList.find("input.button-color").miniColors({change:function(e,d){this.trigger("change")}});this.elems.buttonList.sortable({axis:"y",items:"li.button-row",handle:".button-drag-handle"});this.elems.form.find(".fancy").fancy();this.interfaces();this.updateIconStyle();this.updateAvailableButtons();this.assignEvents()},interfaces:function(){var o=this;for(var e in FlareInterfaces){var j=FlareInterfaces[e];var f=b("#"+e);if(f.length&&!f.is('input[type="hidden"]')){switch(j.type){case"slider":var p={animate:true,min:1,max:100,orientation:"horizontal",range:false,step:1};var n={};for(var m in p){if(j[m]){n[m]=j[m]}else{n[m]=p[m]}}b("#"+e).wrap('<div class="flare-slider-wrapper"></div>');b("#"+e).before('<div id="'+e+'-slider" class="flare-slider"><span class="min">'+(j.minLabel?j.minLabel:n.min)+'</span><span class="max">'+(j.maxLabel?j.maxLabel:n.max)+"</span></div>");var k=b("#"+e+"-slider");if(f.is("select")){k.after('<span class="selected">'+f.find("option:selected").text()+"</span>")}if(j.marks){var h=(n.max-n.min);var d=(h/n.step);var l="";for(var g=0;g<d;g++){l+='<span class="mark" style="width:'+(100/d)+'%">'+(n.min+(n.step*(g+1)))+"</span>"}k.append('<span class="marks">'+l+"</span>")}n.value=f.val();n.slide=function(i,q){var r=b.data(this,"$input");if(!r){var r=b("#"+q.handle.parentNode.id.replace("-slider",""));b.data(this,r)}if(r.is('input[type="text"]')){r.val(q.value)}else{if(r.is("select")){r.find("option").each(function(){if(this.value==q.value){this.selected=true}else{this.selected=false}});b(q.handle.parentNode).next(".selected").text(r.find("option:selected").text())}}};n.change=function(i,q){var r=b.data(this,"$input");if(!r){var r=b("#"+q.handle.parentNode.id.replace("-slider",""));b.data(this,"$input",r)}if(FlareInterfaces[r.attr("id")].update){o.interfaceUpdate(r.val(),"slider",FlareInterfaces[r.attr("id")].update)}};k.slider(n);b("#"+e).bind("keyup",function(q){var i=this;if(this.sliderTimer){clearTimeout(i.sliderTimer)}this.sliderTimer=setTimeout(function(){b("#"+i.id+"-slider").slider("value",i.value)},250);return true});break}}}},interfaceUpdate:function(f,e,d){switch(e){case"slider":var g=b("#options-"+d.option);g.val(Math.min(parseInt(g.val(),10),parseInt(f,10)));var h=b("#options-"+d.option+"-slider");if(h.length){h.slider("option",d.value,f);if(d.value=="min"){h.find(".min").text(f)}else{if(d.value=="max"){h.find(".max").text(f)}}h.slider("value",parseInt(g.val(),10))}break}},updateAvailableButtons:function(){var d=this;this.elems.addButtons.find("li").show();var e=this.elems.addButtons.find("li").length;this.elems.buttonList.find(".button-row").each(function(h){var f=b(this);var g=f.attr("data-button-type");b("#"+d.ns+"-available-button-"+g).hide();e--});if(e>0){this.elems.addButtons.removeClass("disabled")}else{this.elems.addButtons.find("ul.buttons-open").removeClass("buttons-open");this.elems.addButtons.addClass("disabled")}},updateIconStyle:function(){var f=[];this.elems.iconStyle.find("option").each(function(){f.push(this.value)});var d=this.elems.buttonList.find("."+this.ns+"-button");for(var e in f){d.removeClass(this.ns+"-iconstyle-"+f[e])}d.addClass(this.ns+"-iconstyle-"+this.elems.iconStyle.val())},updatePositions:function(){var d=[];this.elems.positionChoices.find('input[name="data[positions][]"]:checked, select[name="data[positions][]"]').each(function(){d.push(b(this).val())});this.elems.positionDisplay.find("span").hide();for(var e in d){if(d[e]!=""){this.elems.positionDisplay.find("span."+d[e]).show()}}}};b(document).ready(function(){FlareAdmin.initialize();b("#toplevel_page_flare").find('.wp-submenu a[href$="/dtlabs"]').attr("target","_blank");b("#flare-blog-rss-feed").load(ajaxurl+"?action=flare_blog_feed")})})(jQuery,window,null);